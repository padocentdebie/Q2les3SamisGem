<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Proces-Verbaal Oefening - Dossier Samir</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --primary-blue: #1d4e89;
            --accent-gold: #f9d423;
            --border-gray: #cbd5e0;
            --bg-light: #f4f7f9;
            --text-main: #2d3748;
            --success-green: #28a745;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: var(--bg-light); color: var(--text-main); padding: 40px 20px; }
        .container { max-width: 950px; margin: auto; background: white; padding: 40px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .header { color: var(--primary-blue); border-bottom: 3px solid var(--accent-gold); text-transform: uppercase; text-align: center; padding-bottom: 15px; margin-bottom: 30px; }
        
        .stap-box { border: 1px solid var(--border-gray); border-left: 5px solid var(--primary-blue); padding: 25px; margin-bottom: 25px; background: #fff; }
        .action-button { display: inline-block; background: var(--primary-blue); color: white !important; padding: 12px 24px; text-decoration: none; border-radius: 4px; font-weight: bold; text-transform: uppercase; }
        
        input, textarea { width: 100%; padding: 12px; border: 1px solid var(--border-gray); border-radius: 4px; box-sizing: border-box; margin-bottom: 10px; }
        .submit-btn { background: var(--success-green); color: white; border: none; padding: 15px; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%; text-transform: uppercase; }

        /* Kaarten en Feedback */
        .aangifte-kaart { border: 1px solid var(--border-gray); margin-top: 20px; padding: 20px; background: #fff; position: relative; }
        .tekst-weergave { white-space: pre-wrap; background: #f8fafc; padding: 15px; border: 1px solid #edf2f7; margin-bottom: 10px; }
        
        .feedback-display { background: #eef6ff; border-left: 4px solid var(--primary-blue); padding: 10px 15px; margin-top: 10px; font-size: 0.9em; font-style: italic; }
        .feedback-kolom { background: #fffdf2; border: 1px solid #f9d423; padding: 15px; border-radius: 4px; display: none; margin-top: 10px; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .secondary-btn { background: none; border: 1px solid var(--primary-blue); color: var(--primary-blue); padding: 8px 14px; cursor: pointer; font-size: 0.8em; font-weight: bold; text-transform: uppercase; }
        .all-pdf-btn { background: #e53e3e; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin-bottom: 20px; font-weight: bold; }

        .vinklijst { list-style: none; padding: 0; margin-bottom: 10px; font-size: 0.85em; }
        .vinklijst li { margin-bottom: 5px; display: flex; align-items: center; }
        .vinklijst input { margin-right: 10px; }

        .admin-zone { margin-top: 100px; padding: 20px; border: 2px dashed #cbd5e0; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>Dossier: Aangifte van Samir</h1></div>

    <div class="stap-box">
        <h3>1. Informatieverzameling</h3>
        <center><a href="https://gemini.google.com/gem/e6e35023ee68" target="_blank" class="action-button">Start verhoormodule</a></center>
    </div>

    <div class="stap-box">
        <h3>2. Proces-Verbaal Inleveren</h3>
        <input type="text" id="student-naam" placeholder="Je voornaam">
        <textarea id="input-tekst" placeholder="Typ hier de officiÃ«le aangifte tekst (ik-vorm, OVT)..." style="height: 150px;"></textarea>
        <button class="submit-btn" onclick="verstuurData()">Publiceer voor de klas</button>
    </div>

    <h2 style="color: var(--primary-blue); margin-top: 50px;">Live Feed</h2>
    <button class="all-pdf-btn" onclick="downloadAllePDFs()">Download Alle PV's (PDF)</button>
    
    <div id="live-feed">Laden...</div>

    <div class="admin-zone">
        <button style="color:red; cursor:pointer;" onclick="wisAlles()">Wis alle sessie-data</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBj8dXkl1rEfyx54_MDy_tYd2P7kAeU8VQ",
        authDomain: "q2les3samirgem.firebaseapp.com",
        databaseURL: "https://q2les3samirgem-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "q2les3samirgem",
        storageBucket: "q2les3samirgem.firebasestorage.app",
        messagingSenderId: "8681998187",
        appId: "1:8681998187:web:fd08067494a010dc572e2e"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    function verstuurData() {
        const naam = document.getElementById('student-naam').value;
        const tekst = document.getElementById('input-tekst').value;
        if(!naam || !tekst) return alert("Vul alles in.");

        database.ref('aangiftes').push({
            naam: naam,
            tekst: tekst,
            feedback: { v1:false, v2:false, v3:false, v4:false, v5:false, v6:false, v7:false, v8:false, opmerking: "" }
        });
        document.getElementById('input-tekst').value = '';
    }

    function saveFeedback(key) {
        const opm = document.getElementById('opm-' + key).value;
        database.ref('aangiftes/' + key + '/feedback').update({ opmerking: opm });
        alert("Feedback gepubliceerd.");
    }

    function updateCheck(key, field, value) {
        database.ref('aangiftes/' + key + '/feedback').update({ [field]: value });
    }

    database.ref('aangiftes').on('value', (snapshot) => {
        const feed = document.getElementById('live-feed');
        feed.innerHTML = '';
        const data = snapshot.val();
        if (data) {
            Object.keys(data).reverse().forEach(key => {
                const item = data[key];
                const fb = item.feedback || {};
                const kaart = document.createElement('div');
                kaart.className = 'aangifte-kaart';
                kaart.innerHTML = `
                    <div class="pv-sectie">
                        <strong style="color:var(--primary-blue);">Verbalisant: ${item.naam}</strong>
                        <div class="tekst-weergave">${item.tekst}</div>
                        
                        ${fb.opmerking ? `<div class="feedback-display"><strong>Feedback:</strong> ${fb.opmerking}</div>` : ''}
                        
                        <div class="btn-group">
                            <button class="secondary-btn" onclick="toggleFB('${key}')">Beoordelen</button>
                        </div>
                    </div>

                    <div class="feedback-kolom" id="fb-${key}">
                        <ul class="vinklijst">
                            <li><input type="checkbox" ${fb.v1?'checked':''} onchange="updateCheck('${key}','v1',this.checked)"> Bestanddeeltekst</li>
                            <li><input type="checkbox" ${fb.v2?'checked':''} onchange="updateCheck('${key}','v2',this.checked)"> Gouden W's</li>
                            <li><input type="checkbox" ${fb.v4?'checked':''} onchange="updateCheck('${key}','v4',this.checked)"> Ik-vorm / OVT</li>
                        </ul>
                        <textarea id="opm-${key}" placeholder="Typ hier je feedback..." style="height:60px;">${fb.opmerking || ""}</textarea>
                        <button class="submit-btn" style="padding:5px;" onclick="saveFeedback('${key}')">Feedback Opslaan</button>
                    </div>
                `;
                feed.appendChild(kaart);
            });
        }
    });

    function toggleFB(id) {
        const el = document.getElementById('fb-' + id);
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    function downloadAllePDFs() {
        const element = document.getElementById('live-feed');
        const opt = { margin: 10, filename: 'Alle_PV_Aangiftes.pdf', html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } };
        html2pdf().set(opt).from(element).save();
    }

    function wisAlles() {
        if(confirm("Sessie resetten?")) database.ref('aangiftes').remove();
    }
</script>

</body>
</html>
